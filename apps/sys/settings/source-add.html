! name:  Add Source
! icon:  globe
! title: Add Source

<main style = "margin: 10px; color: black;">
    <fieldset>
        <legend>Source URL</legend>
        <input placeholder = "https://os.iipython.dev" style = "width: 300px;">
        <legend style = "margin-top: 5px;">The source will apply after an OS reload.</legend>
    </fieldset>
    <div class = "button-list" style = "margin-top: 5px;">
        <button id = "cancel">Cancel</button>
        <button id = "ok">OK</button>
    </div>
</main>
<script>(() => {
    const dom = roots["%OS_ROOT"];
    const evil_regex = /(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/;
    dom.getElementById("cancel").addEventListener("click", () => kill_app("%OS_ROOT"));
    dom.getElementById("ok").addEventListener("click", async () => {
        const source_url = dom.querySelector("input").value;
        if (!evil_regex.test(source_url)) return create_error("Invalid Source URL", "Specified URL is invalid!");
        const sources = JSON.parse(await db.get("app-sources"));
        sources.push({ url: source_url, status: null, apps: null });
        db.set("app-sources", JSON.stringify(sources));
        if (window.on_source_added) window.on_source_added();
        kill_app("%OS_ROOT");
    });
})();</script>

