! name:  Welcome!
! icon:  pc-configure
! title: Welcome to iiPython OS

<!-- Styling -->
<style>
    * {
        font-family: monospace;
        margin: 0px;
        color: black;
    }
    main {
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    span {
        color: gray;
        font-size: 10px;
    }
    section {
        justify-content: flex-end;
    }
    label {
        display: flex;
        gap: 10px;
    }
</style>

<!-- Actual content! -->
<main>
    <p>
        Hello, and welcome to iiPython OS! <br>
        This wizard will help you setup and configure the base operating system.
    </p>
    <br>
    <fieldset>
        <legend>To begin, select a storage backend:</legend>
    </fieldset>
    <section class = "field-row">
        <button id = "cancel">Cancel</button>
        <button id = "ok">OK</button>
    </section>
</main>

<!-- JS -->
<script>
    for (const backend of [
        { name: "LocalStorage", id: "localstorage", text: "less space, more reliable" },
        { name: "IndexedDB", id: "indexeddb", text: "more space" },
        { name: "DmmD's API", id: "dmmd", text: "for dmmd's bootloader" }
    ]) {
        const div = document.createElement("div");
        div.innerHTML = `
            <input type = "radio" name = "backend" value = "${backend.id}" id = "${backend.id}"${backend.id === "localstorage" ? " checked" : ""}${backend.id === "dmmd" ? " disabled" : ""}/>
            <label for = "${backend.id}">${backend.name} <span>(${backend.text})</span></label>
        `;
        dom.querySelector("fieldset").appendChild(div);
    }

    const current_backend = await oscall("db.get_backend");
    dom.getElementById(current_backend).checked = true;

    // Handle buttons
    dom.getElementById("cancel").addEventListener("click", async () => await oscall("app.kill"));
    dom.getElementById("ok").addEventListener("click", async () => {
        await oscall("db.set", "first_boot", 1);
        await oscall("db.set_backend", [...dom.querySelectorAll("input")].filter(i => i.checked)[0].value);
        await oscall("app.run", "sys/settings/reload");
        await oscall("app.kill");
    });
</script>
